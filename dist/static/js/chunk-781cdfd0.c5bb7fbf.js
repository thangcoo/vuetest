(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-781cdfd0"],{"33c1":function(e,t,a){"use strict";var r=a("7783"),s=a.n(r);s.a},5044:function(e,t,a){},7783:function(e,t,a){},ad8f:function(e,t,a){"use strict";a.d(t,"b",function(){return s}),a.d(t,"d",function(){return n}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return i});var r=a("b775");function s(e){return Object(r["a"])({url:"/user/inquire",method:"post",data:e})}function n(e){return Object(r["a"])({url:"/user/update",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/user/reg",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/user/del",method:"post",data:e})}},bff8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tableWrap"},["0"==e.roles?a("add-read",{staticClass:"btn",attrs:{types:"add"},on:{add:e.getCourses}}):e._e(),e._v(" "),a("el-table",{staticClass:"courseLists",staticStyle:{width:"100%"},attrs:{data:e.courseLists,border:""}},[a("el-table-column",{attrs:{prop:"_id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"courseName",label:"课程名"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("filterStatus")(t.row.status)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"teacher.username",label:"老师"}}),e._v(" "),a("el-table-column",{attrs:{prop:"credit",label:"学分"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),a("el-table-column",{staticClass:"manu",attrs:{label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==e.roles?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handlePublish(t.$index,t.row)}}},[e._v(e._s(e._f("filterState0")(t.row.status)))]):e._e(),e._v(" "),"1"==e.roles?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleStart(t.$index,t.row)}}},[e._v(e._s(e._f("filterState1")(t.row.status)))]):e._e(),e._v(" "),a("score-update",{attrs:{data:e.scoreLists,dialogTableVisible:e.dialogTableVisible},on:{"update:dialogTableVisible":function(t){e.dialogTableVisible=t},"update:dialog-table-visible":function(t){e.dialogTableVisible=t}}}),e._v(" "),"2"==e.roles&&"selfCourse"==e.$route.name?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.updataCour(t.row)}}},[e._v(e._s(e._f("filterState2")(t.row.status)))]):e._e(),e._v(" "),"2"==e.roles&&"unselfCourse"==e.$route.name?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.updataCour(t.row)}}},[e._v("选课")]):e._e(),e._v(" "),a("add-read",{attrs:{types:"read",row:t.row,index:t.$index}}),e._v(" "),"0"==e.roles?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[10,20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},s=[],n=(a("6762"),a("2fdb"),a("7f7f"),a("cebc")),o=a("2f62"),i=a("b775");function l(e){return Object(i["a"])({url:"/course/inquire",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/course/add",method:"post",data:e})}function u(e){return Object(i["a"])({url:"/course/update",method:"post",data:e})}function d(e){return Object(i["a"])({url:"/course/del",method:"post",data:e})}function f(e){return Object(i["a"])({url:"/score/inquire",method:"post",data:e})}function m(e){return Object(i["a"])({url:"/chart/getScore",method:"post",data:e})}function p(e){return Object(i["a"])({url:"/score/update",method:"post",data:e})}var h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-read"},["add"==e.types?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleAdd()}}},[e._v("新增")]):a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleRead(e.index,e.row)}}},[e._v("查看")]),e._v(" "),a("el-dialog",{attrs:{title:"add"==e.types?"新增":"查看",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"课程名",prop:"name"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"课程名",disabled:e.read},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上课老师",prop:"teacher"}},[a("el-select",{attrs:{placeholder:"上课老师",disabled:e.read},model:{value:e.form.teacher,callback:function(t){e.$set(e.form,"teacher",t)},expression:"form.teacher"}},e._l(e.teachers,function(e){return a("el-option",{attrs:{value:e.username}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"学分",prop:"score"}},[a("el-input",{attrs:{type:"number",autocomplete:"off",placeholder:"学分",disabled:e.read},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"备注",disabled:e.read},model:{value:e.form.other,callback:function(t){e.$set(e.form,"other",t)},expression:"form.other"}})],1),e._v(" "),e.show?a("div",[a("el-form-item",{staticClass:"last",attrs:{label:"选课学生"}}),e._v(" "),a("p",{staticClass:"students"},e._l(e.students,function(t){return a("span",[e._v(e._s(t.username))])}),0)],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.cancelHandler("form")}}},[e._v("取 消")]),e._v(" "),"add"==e.types?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitHandler("form")}}},[e._v("确 定")]):e._e()],1)],1),e._v(" "),e.showChart?a("score-view",{attrs:{data:e.chartData,dialogChartVisible:e.dialogChartVisible},on:{"update:dialogChartVisible":function(t){e.dialogChartVisible=t},"update:dialog-chart-visible":function(t){e.dialogChartVisible=t}}}):e._e()],1)},b=[],v=(a("c5f6"),a("ad8f")),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"成绩考核",visible:e.visible,width:"80%"},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.$emit("update:dialogChartVisible",!1)}}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[a("el-tab-pane",{attrs:{label:"总体成绩",name:"all"}},[a("div",{ref:"barchart",staticStyle:{width:"100%",height:"600px"}})]),e._v(" "),a("el-tab-pane",{attrs:{label:"我的成绩",name:"mine"}},[a("div",{ref:"radarChart",staticStyle:{width:"100%",height:"100%"}})])],1)],1)},g=[],w=a("3eba"),y=a.n(w),x=(a("94b1"),a("ef97"),a("8deb"),a("007d"),a("db0e"),a("95a8"),a("d28f"),a("b11c"),{name:"bar-chart",props:{data:{type:Array},dialogChartVisible:{type:Boolean,default:!1}},data:function(){return{visible:this.dialogChartVisible,chartdata:[],active:"all"}},watch:{dialogChartVisible:function(){this.visible=this.dialogChartVisible},data:function(){this.chartdata=this.data}},created:function(){this.$nextTick(function(){this.drawbarChart(),this.drawRadar()})},methods:{drawbarChart:function(){console.log(this.data);var e=[];e=this.data.map(function(e){return e.student.username}),console.log(e);var t={legend:{data:["总分","课堂表现","作业情况","实验实践","出勤情况","其他","卷面成绩"]},xAxis:{axisPointer:{show:!0,type:"shadow"},data:e},yAxis:[{type:"value",name:"总分/卷面",splitNumber:10,axisPointer:{show:!0,type:"line",lineStyle:{type:"dashed"}},max:100,min:0},{type:"value",name:"表现分",splitNumber:10,axisPointer:{show:!0,type:"line",lineStyle:{type:"dashed"}},max:10,min:0}],toolbox:{show:!0,right:"200px",feature:{dataView:{show:!0},magicType:{show:!0,type:["bar","line"]},saveAsImage:{show:!0}}},series:[{name:"总分",type:"bar",data:this.data.map(function(e){return e.score.performance+e.score.operation+e.score.experiment+e.score.attendance+e.score.other+e.score.paper}),markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:"课堂表现",type:"bar",data:this.data.map(function(e){return 10*e.score.performance})},{name:"作业情况",type:"bar",data:this.data.map(function(e){return 10*e.score.operation})},{name:"实验实践",type:"bar",data:this.data.map(function(e){return 10*e.score.experiment})},{name:"出勤情况",type:"bar",data:this.data.map(function(e){return 10*e.score.attendance})},{name:"其他",type:"bar",data:this.data.map(function(e){return 10*e.score.other})},{name:"卷面成绩",type:"bar",data:this.data.map(function(e){return e.score.paper})}]},a=this.$refs.barchart,r=y.a.init(a);r.setOption(t)},drawRadar:function(){var e=this.$refs.radarChart,t=y.a.init(e);t.setOption(t)}}}),C=x,k=a("2877"),$=Object(k["a"])(C,_,g,!1,null,null,null),S=$.exports,V={name:"add-read",props:{types:{type:String,required:!0},row:{type:Object,default:function(){return{}}},index:{type:Number,default:0}},computed:Object(n["a"])({},Object(o["b"])(["roles"])),data:function(){return{dialogFormVisible:!1,dialogChartVisible:!1,teachers:[],students:[],chartData:[],read:!1,form:{name:"",teacher:"",score:"",other:""},rules:{name:[{required:!0,message:"课程名不能为空",trigger:"blur"}],teacher:[{required:!0,message:"请选择上课老师",trigger:"change"}],score:[{required:!0,message:"学分不能为空",trigger:"blur"}]},show:!1,showChart:!1}},created:function(){this.getTeachers()},components:{scoreView:S},methods:{getTeachers:function(){var e=this;Object(v["b"])({role:"1"}).then(function(t){e.teachers=t.data.userLists})},submitHandler:function(e){var t=this;this.$refs[e].validate(function(a){if(!a)return console.log("error submit!!"),!1;var r=t.teachers.filter(function(e){return e.username==t.form.teacher}),s={courseName:t.form.name,credit:t.form.score,remark:t.form.other,teacher:r[0]._id};c(s).then(function(a){1==a.code&&(t.$emit("add"),t.cancelHandler(e),t.$message({type:"success",message:"操作成功"}))})})},handleRead:function(e,t){var a=this;t.students.length>0&&(this.show=!0),"2"==t.status?m({course:t._id}).then(function(e){a.chartData=e.data.scoreLists,a.showChart=!0,a.dialogChartVisible=!0}):(this.dialogFormVisible=!0,this.read=!0,this.form.name=t.courseName,this.form.teacher=t.teacher.username,this.form.score=t.credit,this.form.other=t.remark,Object(v["b"])({role:"2"}).then(function(e){a.students=e.data.userLists.filter(function(e){for(var a=0;a<t.students.length;a++)if(e._id==t.students[a])return!0})}))},handleAdd:function(){this.dialogFormVisible=!0},cancelHandler:function(e){this.$refs[e].resetFields(),this.dialogFormVisible=!1}}},z=V,O=(a("33c1"),Object(k["a"])(z,h,b,!1,null,null,null)),j=O.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"scoreDial",attrs:{title:"成绩考核",visible:e.visible,width:"95%"},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.$emit("update:dialogTableVisible",!1)}}},[a("el-table",{attrs:{data:e.scoreLists}},[a("el-table-column",{attrs:{property:"student.number",label:"学号",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{property:"student.username",label:"姓名",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{label:"课堂表现(6分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:6},model:{value:t.row.score.performance,callback:function(a){e.$set(t.row.score,"performance",a)},expression:"scope.row.score.performance"}}):a("span",[e._v(e._s(t.row.score.performance))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"作业情况(6分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:6},model:{value:t.row.score.operation,callback:function(a){e.$set(t.row.score,"operation",a)},expression:"scope.row.score.operation"}}):a("span",[e._v(e._s(t.row.score.operation))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"实验实践(6分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:6},model:{value:t.row.score.experiment,callback:function(a){e.$set(t.row.score,"experiment",a)},expression:"scope.row.score.experiment"}}):a("span",[e._v(e._s(t.row.score.experiment))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"出勤情况(6分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:6},model:{value:t.row.score.attendance,callback:function(a){e.$set(t.row.score,"attendance",a)},expression:"scope.row.score.attendance"}}):a("span",[e._v(e._s(t.row.score.attendance))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"其他(6分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:6},model:{value:t.row.score.other,callback:function(a){e.$set(t.row.score,"other",a)},expression:"scope.row.score.other"}}):a("span",[e._v(e._s(t.row.score.other))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"卷面成绩(70分)"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("el-input-number",{attrs:{size:"mini",min:0,max:70,step:5},model:{value:t.row.score.paper,callback:function(a){e.$set(t.row.score,"paper",a)},expression:"scope.row.score.paper"}}):a("span",[e._v(e._s(t.row.score.paper))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"总分"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"sum"},[e._v(e._s(e.sum(t.row.score)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?e._e():a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.row.edit=!0}}},[e._v("编辑")]),e._v(" "),t.row.edit?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.saveScore(t.row)}}},[e._v("保存")]):e._e(),e._v(" "),t.row.edit?a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.row.edit=!1}}},[e._v("取消")]):e._e()]}}])})],1)],1)},T=[],I={props:{data:{type:Array},dialogTableVisible:{type:Boolean,default:!1}},data:function(){return{visible:this.dialogTableVisible,scoreLists:this.data}},watch:{dialogTableVisible:function(){this.visible=this.dialogTableVisible},data:function(){this.scoreLists=this.data}},methods:{sum:function(e){return e.performance+e.operation+e.experiment+e.attendance+e.other+e.paper},saveScore:function(e){var t=this,a={scoreId:e._id,score:e.score};p(a).then(function(a){1==a.code&&(t.$message({type:"success",message:"操作成功"}),e.edit=!1)})}}},H=I,q=Object(k["a"])(H,L,T,!1,null,null,null),A=q.exports,D={name:"course",data:function(){return{size:10,current:1,total:0,courseLists:[],row:{},scoreLists:[],dialogTableVisible:!1,assess:!1}},components:{addRead:j,scoreUpdate:A},computed:Object(n["a"])({},Object(o["b"])(["roles","userId"])),created:function(){this.getCourses(this.size)},filters:{filterStatus:function(e){return 0==e?"未发布":1==e?"已发布":"已开课"},filterState0:function(e){return 0==e?"发布":1==e?"取消发布":""},filterState1:function(e){return 1==e?"开课":"考核"},filterState2:function(e){return 1==e?"取消选课":""}},methods:{getCourses:function(e){var t=this;l({pageSize:e}).then(function(e){"2"==t.roles?("selfCourse"==t.$route.name?t.courseLists=e.data.courseLists.filter(function(e){return e.students.includes(t.userId)}):t.courseLists=e.data.courseLists.filter(function(e){return!e.students.includes(t.userId)}),t.total=t.courseLists.length):(t.courseLists=e.data.courseLists,t.total=e.data.totalPage)})},getScore:function(e){var t=this;f(e).then(function(e){t.scoreLists=e.data.scoreLists,t.scoreLists.map(function(e){t.$set(e,"edit",!1)})})},successHandler:function(e){1==e.code&&(this.getCourses(this.size),this.$message({type:"success",message:"操作成功"}))},handlePublish:function(e,t){0==t.status?t.status=1:t.status=0,this.updataCour(t)},handleStart:function(e,t){0==t.students.length?this.$message({type:"error",message:"没有学生选课不能开课"}):1==t.status?(t.status=2,this.updataCour(t)):(this.dialogTableVisible=!0,this.getScore({course:t._id}))},updataCour:function(e){var t,a=this,r="unselfCourse"==this.$route.name?"add":"remove";t="2"==this.roles?{courseId:e._id,userId:this.userId,flag:r}:{courseId:e._id,status:e.status,remark:e.remark,teacher:e.teacher._id},u(t).then(function(e){a.successHandler(e)})},handleDelete:function(e,t){var a=this;this.$confirm("确定对id=".concat(t._id,"进行删除操作?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){d({courseId:t._id}).then(function(e){a.successHandler(e)})})},handleSizeChange:function(e){this.size=e,this.getCourses(this.size)},handleCurrentChange:function(e){this.current=e,this.getCourses(this.size)}}},F=D,P=(a("e03b"),Object(k["a"])(F,r,s,!1,null,null,null));t["default"]=P.exports},e03b:function(e,t,a){"use strict";var r=a("5044"),s=a.n(r);s.a}}]);